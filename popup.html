<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      width: 220px;
      padding: 15px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
    }
    .popup-header { text-align: center; margin-bottom: 15px; }
    .popup-title { font-size: 16px; font-weight: 600; color: #333; margin: 0 0 5px 0; }
    .popup-subtitle { font-size: 12px; color: #666; margin: 0; }
    .popup-icon { font-size: 24px; margin-bottom: 8px; }
    .toggle-container { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; }
    .toggle-label { font-size: 14px; color: #333; font-weight: 500; }
    .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #f1c40f; }
    input:checked + .slider:before { transform: translateX(22px); }
  </style>
</head>
<body>
  <div class="popup-header">
    <div class="popup-icon">ðŸ¤–</div>
    <h1 class="popup-title">AI Chat Assistant</h1>
    <p class="popup-subtitle">Your AI-powered coding companion</p>
  </div>
  
  <div class="popup-content">
    <div class="toggle-container">
      <span class="toggle-label">Show Chat Button</span>
      <label class="switch">
        <input type="checkbox" id="toggleChatButton">
        <span class="slider"></span>
      </label>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('toggleChatButton');

      // Load and set the current state of the toggle
      chrome.storage.sync.get({isChatButtonEnabled: true}, (result) => {
        toggle.checked = result.isChatButtonEnabled;
      });

      // Listen for changes and update storage/content script
      toggle.addEventListener('change', () => {
        const isEnabled = toggle.checked;
        chrome.storage.sync.set({ isChatButtonEnabled: isEnabled });

        // Notify the active tab to show/hide the button immediately
        chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
          if (tabs[0] && tabs[0].id) {
            chrome.tabs.sendMessage(tabs[0].id, {
              action: 'toggleChatButtonVisibility',
              visible: isEnabled
            });
          }
        });
      });
    });
  </script>
</body>
</html>